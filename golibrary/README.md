# バスサジェストシステムver.1.0 仕様書
##概要
鯖江市立図書館への行き帰りにおいて，次のバス（つつじバス）が発車する時間と，発車時刻までの残り時間を表示するシステムです．

##使い方
乗車するバス停を選ぶと，次のバスが発車する時刻と発車までの時間が表示される仕組みになっています．  
図書館から帰る場合も同様に，図書館発のバス停を選ぶと，次のバスについての情報が表示されます．

##コード仕様
jQueryを使って，APIからつつじバス中央線の時刻表を取得し，バス停ごとに固有のページでデータを整理して表示させています．

###トップページと固有ページ，各バス停ごとの時刻表表示
busstop.htmlがトップページに相当し，乗車するバス停を選びます．
選ばれたバス停は固有ページとなり，先述の方法でデータを取得し，次のバスのサジェストを行います．(図書館帰りはディレクトリsabaelibrary/,図書館行きはディレクトリbusstops/以下)  
ここで，script部のコメントアウトmain function以下のfor文でバス停の時刻表を表示しています（行き先と発車時刻）．

###次に発車するバスの発車時刻表示
次のコメントアウトindicate next time以下のループで再度データを全部読み直し，次に来るバスの発車時刻を表示します．

APIの仕様上時刻データも文字列として配信されるので，文字列から数字に変換しています．その過程で，“時間”と“分”が別々に変数に格納されています(変数hour1,minute1)．それに合わせて，現在時刻も時間と分を別々に格納しています(変数hour2,minute2)．

次のバスの発車時刻は，全データに対して現在時刻から差分演算を行って，最も近い時間を表示する仕組みになっています．その際にフラグを用いて次の時間を表すデータを管理しています．

###バスが発車するまでの残り時間表示
次に発車するバスの発車時刻がわかったら，その発車時刻までに残された時間を表示します(コメントアウトcountdown以下)．

こちらも差分演算で残り時間を計算していますが，次のバスが来るまで1時間以上ある場合とそうでない場合を区別するために，ここでもフラグを使って計算結果を管理しています．
計算が終了すると，それぞれのフラグ状況に応じて表示形態を選んで表示させます．

###その他
次のバスまで3時間以上の空き時間が存在する場合には，時間ではなくメッセージを表示する仕組みになっています．

##今後について
図書館行きについて，帰りのバスについても同時にサジェストする機能を追加実装する予定です．  
また，APIから取得した時刻について，時間と分を同じ変数で管理するほうがバグにならないと思うので，その点で改良を行いたいと考えています．

##さいごに
何か不具合等ありましたら，下記まで連絡をお願いいたします．
* 作成者：久保 陽一郎
* 連絡先：heimusu@gmail.com
